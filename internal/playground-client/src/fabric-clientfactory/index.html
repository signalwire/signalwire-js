<!DOCTYPE html>
<html>
  <head>
    <title>ClientFactory Demo</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Cross Browser WebRTC Adapter -->
    <script
      type="text/javascript"
      src="https://webrtc.github.io/adapter/adapter-latest.js"
    ></script>

    <!-- To style up the demo a little -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link
      rel="shortcut icon"
      href="https://signalwire.com/assets/images/favicon.ico"
    />
  </head>
  <body class="bg-light">
    <div class="container">
      <div class="row pt-5">
        <div class="col-12 pb-3">
          <h1>ClientFactory Demo</h1>
          <p class="text-muted">Multi-profile client management showcase</p>
        </div>
      </div>
      <hr />
      <div class="row py-3">
        <!-- Profile Management -->
        <div class="col-12 col-md-4">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">
                <i class="bi bi-person-plus me-2"></i>Profile Management
              </h5>
              
              <!-- JSON Credentials Input -->
              <div class="form-group mb-3">
                <label for="credentialsInput" class="form-label">
                  JSON Credentials
                  <small class="text-muted">(Paste profile credentials)</small>
                </label>
                <textarea
                  id="credentialsInput"
                  class="form-control"
                  rows="4"
                  placeholder='{"host": "example.signalwire.com", "token": "your-token", "addressId": "address-id", "displayName": "Profile Name"}'
                  onchange="saveInLocalStorage(event)"
                ></textarea>
              </div>
              
              <!-- Add Profile Button -->
              <div class="d-grid gap-2 mb-3">
                <button
                  id="btnAddProfile"
                  class="btn btn-primary"
                  onclick="addProfile()"
                >
                  <i class="bi bi-plus-circle me-1"></i>Add Profile
                </button>
              </div>

              <!-- Profiles List -->
              <div class="card mb-3" id="profilesCard">
                <div class="card-header d-flex justify-content-between align-items-center">
                  <span>
                    <i class="bi bi-people me-1"></i>Profiles
                  </span>
                  <button
                    class="btn btn-outline-danger btn-sm"
                    id="btnClearProfiles"
                    onclick="clearAllProfiles()"
                    title="Clear all profiles"
                  >
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
                <div class="card-body p-0">
                  <ul id="profilesList" class="list-group list-group-flush">
                    <li class="list-group-item text-muted text-center py-3">
                      <i class="bi bi-person-x fs-4 d-block mb-2"></i>
                      No profiles added yet
                    </li>
                  </ul>
                </div>
              </div>

              <!-- Profile Selector -->
              <div class="form-group mb-3">
                <label for="profileSelector" class="form-label">
                  <i class="bi bi-person-check me-1"></i>Active Profile
                </label>
                <select
                  id="profileSelector"
                  class="form-select"
                  onchange="selectProfile()"
                  disabled
                >
                  <option value="">Select a profile</option>
                </select>
              </div>

              <!-- Connect Button -->
              <div class="d-grid gap-2 mb-2">
                <button
                  id="btnConnect"
                  class="btn btn-success"
                  onclick="connect()"
                  disabled
                >
                  <i class="bi bi-wifi me-1"></i>Load Addresses
                </button>
              </div>

              <div class="text-center text-muted">
                <small>Select a profile to enable connection</small>
              </div>
            </div>
          </div>

          <!-- Call Status -->
          <div id="callStatusCard" class="row py-2 px-2 d-none">
            <div class="card p-0">
              <div class="card-header d-flex justify-content-between align-items-center">
                <span>
                  <i class="bi bi-telephone me-1"></i>Active Call
                </span>
                <span id="callDuration" class="badge bg-success">00:00</span>
              </div>
              <div class="card-body">
                <div class="row align-items-center">
                  <div class="col-8">
                    <div class="d-flex flex-column">
                      <span id="callAddress" class="fw-bold text-truncate">No active call</span>
                      <span id="callStatus" class="text-muted small">Idle</span>
                    </div>
                  </div>
                  <div class="col-4 text-end">
                    <div class="btn-group" role="group">
                      <button
                        id="executeMethodBtn"
                        class="btn btn-sm btn-outline-primary"
                        onclick="openExecuteModal()"
                        title="Execute Method"
                      >
                        <i class="bi bi-play-circle"></i>
                      </button>
                      <button
                        id="hangupBtn"
                        class="btn btn-sm btn-outline-danger"
                        onclick="hangupCall()"
                        title="Hangup Call"
                      >
                        <i class="bi bi-telephone-x"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Call Status end -->

          <!-- Conversation logs -->
          <div id="controlConvo" class="row py-2 px-2">
            <div class="card p-0">
              <div class="card-header">
                <i class="bi bi-chat-dots me-1"></i>Conversation logs
              </div>
              <div class="card-body px-0 py-1">
                <div
                  class="overflow-auto"
                  style="max-height: 200px; min-height: 100px"
                >
                  <ul
                    id="liveMessageList"
                    class="list-group list-group-flush mt-0"
                  ></ul>
                </div>
              </div>
            </div>
          </div>
          <!-- Conversation logs end -->
        </div>
        <!-- Profile Management end -->

        <div class="col-12 col-md-8 mt-4 mt-md-1">
          <!-- Address/History Tabs -->
          <div id="tabs">
            <ul class="nav nav-tabs">
              <li class="nav-item">
                <button
                  class="nav-link text-secondary"
                  name="History"
                  onclick="toggleTabState('History')"
                >
                  <i class="bi bi-clock-history me-1"></i>History
                </button>
              </li>
              <li class="nav-item">
                <button
                  class="nav-link active"
                  name="Directory"
                  onclick="toggleTabState('Directory')"
                >
                  <i class="bi bi-telephone-book me-1"></i>Directory
                </button>
              </li>
            </ul>

            <!-- Addresses -->
            <div class="card border-top-0 rounded-top-0" id="addressCard">
              <!-- Filters -->
              <div class="input-group mt-1 px-2">
                <span class="input-group-text">
                  <i class="bi bi-search"></i>
                </span>
                <input
                  type="text"
                  class="form-control"
                  placeholder="Search addresses..."
                  aria-label="Search"
                  aria-describedby="searchButton"
                  id="searchInput"
                />
                <select class="form-select" id="searchType">
                  <option value="all" selected>All Types</option>
                  <option value="subscriber">Subscriber</option>
                  <option value="room">Room</option>
                  <option value="call">Call</option>
                  <option value="app">App</option>
                </select>
              </div>
              <!-- Filters end -->

              <div class="card-body" id="addresses">
                <div class="text-center text-muted py-4" id="addressesPlaceholder">
                  <i class="bi bi-telephone fs-1 d-block mb-3"></i>
                  <p>Select a profile and load addresses to get started</p>
                </div>
                <ul class="list-group list-group-flush d-none" id="addressesList"></ul>
              </div>

              <!-- Pagination -->
              <div class="d-flex justify-content-center pb-2 gap-2" id="addressPagination" style="display: none !important;">
                <button
                  name="fetch-prev-address"
                  type="button"
                  class="btn btn-outline-secondary btn-sm"
                  onclick="fetchPrevAddresses()"
                >
                  <i class="bi bi-chevron-left me-1"></i>Prev
                </button>
                <span class="align-self-center mx-2 text-muted small" id="paginationInfo">
                  Page 1
                </span>
                <button
                  name="fetch-next-address"
                  type="button"
                  class="btn btn-outline-secondary btn-sm"
                  onclick="fetchNextAddresses()"
                >
                  Next<i class="bi bi-chevron-right ms-1"></i>
                </button>
              </div>
              <!-- Pagination end -->
            </div>
            <!-- Addresses end -->

            <!-- History -->
            <div
              class="card border-top-0 rounded-top-0 d-none"
              id="historyCard"
            >
              <div class="card-body" id="histories">
                <div class="text-center text-muted py-4" id="historyPlaceholder">
                  <i class="bi bi-clock-history fs-1 d-block mb-3"></i>
                  <p>Your call history will appear here</p>
                </div>
                <ul class="list-group list-group-flush d-none" id="historiesList"></ul>
              </div>
            </div>
            <!-- History end -->
          </div>
          <!-- Address/History Tabs end -->
        </div>
      </div>
      <hr />
      
      <!-- Hidden container for call media -->
      <div id="rootElement" style="display: none;"></div>
    </div>

    <!-- Message Modal -->
    <div
      class="modal fade"
      id="messageModal"
      tabindex="-1"
      aria-labelledby="messageModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="messageModalLabel">
              <i class="bi bi-chat-dots me-2"></i>Conversation
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="container-fluid p-0">
              <div class="text-center mb-4">
                <img
                  src="https://i.pravatar.cc/125"
                  alt="Avatar"
                  class="rounded-circle avatar"
                  style="min-height: 125px"
                />
                <h4 class="title mt-2"></h4>
                <span class="type-badge"></span>
                <div class="contact-buttons mt-3 d-none">
                  <button class="btn btn-success btn-dial-audio d-none me-2">
                    <i class="bi bi-phone me-1"></i>Call
                  </button>
                  <button class="btn btn-primary btn-dial-video d-none me-2">
                    <i class="bi bi-camera-video me-1"></i>Video
                  </button>
                  <button class="btn btn-info btn-dial-messaging d-none">
                    <i class="bi bi-chat me-1"></i>Chat
                  </button>
                </div>
              </div>
              <!-- Messages will be loaded here -->
              <ul
                id="messageList"
                class="overflow-auto list-group list-group-flush"
                style="max-height: calc(100vh - 50vh); min-height: 200px"
              >
                <li class="list-group-item">
                  <div class="d-flex">
                    <div class="placeholder-glow flex-grow-1">
                      <span class="placeholder placeholder-lg col-6"></span>
                      <span class="placeholder placeholder-lg col-12"></span>
                      <span class="placeholder placeholder-lg col-8 mt-2"></span>
                    </div>
                  </div>
                </li>
              </ul>
              <div class="input-group mt-3">
                <input
                  type="text"
                  id="new-conversation-message"
                  class="form-control"
                  placeholder="Type your message..."
                  aria-label="Chat Message"
                  aria-describedby="send-message"
                />
                <button class="btn btn-primary" type="button" id="send-message">
                  <i class="bi-send"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Message Modal end -->

    <!-- Execute Method Modal -->
    <div
      class="modal fade"
      id="executeModal"
      tabindex="-1"
      aria-labelledby="executeModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="executeModalLabel">
              <i class="bi bi-play-circle me-2"></i>Execute Method on Call
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="executeMethod" class="form-label">Method</label>
              <select class="form-select" id="executeMethod">
                <option value="">Select a method</option>
                <option value="play">Play Audio</option>
                <option value="say">Text-to-Speech</option>
                <option value="record">Record Audio</option>
                <option value="detect">Detect Input</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="executeParams" class="form-label">
                Parameters (JSON)
                <small class="text-muted d-block">Enter method parameters as JSON object</small>
              </label>
              <textarea
                class="form-control"
                id="executeParams"
                rows="4"
                placeholder='{"url": "https://example.com/audio.mp3"}'
              ></textarea>
            </div>
            <div class="alert alert-info" role="alert">
              <small>
                <strong>Examples:</strong><br>
                <strong>Play:</strong> {"url": "https://example.com/audio.mp3"}<br>
                <strong>Say:</strong> {"text": "Hello world"}<br>
                <strong>Record:</strong> {"format": "mp3", "max_length": 10}
              </small>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              Cancel
            </button>
            <button type="button" class="btn btn-primary" onclick="executeMethod()">
              Execute
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Execute Method Modal end -->

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <script type="module" src="./index.js"></script>
  </body>
</html>